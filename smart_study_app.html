<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“š ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø°ÙƒÙŠ</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&family=Cascadia+Code:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0F0F15 0%, #1a1a2e 100%);
            min-height: 100vh;
            padding: 0;
            margin: 0;
            overflow: hidden;
        }

        .container {
            max-width: 100%;
            height: 100vh;
            margin: 0;
            background: #F8F9FB;
            display: flex;
            flex-direction: row-reverse;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           Left Panel - Controls
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .left-panel {
            width: 30%;
            background: rgba(26, 26, 46, 0.85);
            border-left: 2px solid rgba(0, 212, 255, 0.15);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            backdrop-filter: blur(10px);
        }

        .header {
            background: linear-gradient(135deg, #00D4FF 0%, #7B2CBF 100%);
            color: white;
            padding: 25px 25px;
            box-shadow: 0 8px 32px rgba(0, 212, 255, 0.2);
        }

        .header h1 {
            font-size: 1.6em;
            margin-bottom: 8px;
            font-weight: 900;
        }

        .header p {
            font-size: 0.9em;
            opacity: 0.9;
            margin: 0;
            line-height: 1.5;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           Ø£Ø²Ø±Ø§Ø± ÙƒØ¨ÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ Ù…Ø¹ Hit Box ÙˆØ§Ø³Ø¹
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .action-buttons {
            padding: 25px 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            flex: 1;
        }

        .big-button {
            width: 100%;
            padding: 18px 20px;
            border: none;
            border-radius: 15px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.2);
            position: relative;
            display: flex;
            align-items: center;
            gap: 12px;
            background: linear-gradient(135deg, #2a2a4a 0%, #3a3a5a 100%);
            color: #00D4FF;
            text-align: left;
            border: 1px solid rgba(0, 212, 255, 0.3);
        }

        .big-button::before {
            content: '';
            position: absolute;
            top: -8px;
            left: -8px;
            right: -8px;
            bottom: -8px;
            z-index: -1;
        }

        .big-button .icon {
            font-size: 1.8em;
            min-width: 40px;
            text-align: center;
        }

        .big-button .label {
            flex: 1;
            font-size: 1.05em;
        }

        .big-button:hover {
            background: linear-gradient(135deg, #00D4FF 0%, #7B2CBF 100%);
            color: #FFFFFF;
            transform: translateX(5px);
            box-shadow: 0 8px 25px rgba(0, 212, 255, 0.4);
            border-color: rgba(0, 212, 255, 0.8);
        }

        .btn-clear {
            background: transparent;
            border: 2px dashed #FF1744;
            color: #FF4081;
        }

        .btn-clear:hover {
            border-color: #FF1744;
            color: #FFFFFF;
            background: rgba(255, 23, 68, 0.2);
            transform: translateX(5px);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           Right Panel - Results
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .right-panel {
            width: 70%;
            background: linear-gradient(135deg, #0F0F15 0%, #1a1a2e 100%);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .right-header {
            background: rgba(26, 26, 46, 0.6);
            border-bottom: 1px solid rgba(0, 212, 255, 0.2);
            padding: 20px 30px;
        }

        .right-header h2 {
            color: #00D4FF;
            font-size: 1.5em;
            font-weight: 800;
            margin: 0;
        }

        .files-section {
            padding: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.8);
        }

        .files-section h2 {
            color: #2B3674;
            margin-bottom: 20px;
            font-size: 1.6em;
            font-weight: 800;
        }

        .files-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
        }

        .file-card {
            background: #FFFFFF;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .file-card:hover {
            border-color: #2B3674;
            background: rgba(255, 255, 255, 0.9);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .file-card .file-icon { font-size: 2.5em; margin-bottom: 10px; text-align: center; }
        .file-card .file-name { font-size: 0.95em; font-weight: 600; color: #2B3674; text-align: center; word-break: break-word; }
        .file-card .file-date { font-size: 0.8em; color: #999; text-align: center; margin-top: 5px; }

        .content-area { 
            padding: 30px;
            flex: 1;
            overflow-y: auto;
            background: transparent;
        }

        .content-area::-webkit-scrollbar {
            width: 10px;
        }

        .content-area::-webkit-scrollbar-track {
            background: transparent;
        }

        .content-area::-webkit-scrollbar-thumb {
            background: rgba(0, 212, 255, 0.3);
            border-radius: 5px;
        }

        .output-box {
            background: transparent;
            border: none;
            padding: 0;
            min-height: 100%;
            font-size: 1.05em;
            line-height: 1.8;
        }

        .summary-card {
            background: rgba(26, 26, 46, 0.7);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 15px;
            box-shadow: 0 8px 32px rgba(0, 212, 255, 0.15);
            border-right: 4px solid #00D4FF;
        }

        .summary-card h3 { 
            color: #00D4FF; 
            margin-bottom: 12px;
            font-weight: 700;
            font-size: 1.2em;
        }

        .summary-card p {
            color: #E0E0E0;
            line-height: 1.8;
        }

        .question-item {
            background: rgba(26, 26, 46, 0.7);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 15px;
            box-shadow: 0 8px 32px rgba(0, 212, 255, 0.15);
            border-right: 4px solid #00CC66;
            font-family: 'Poppins', 'Cairo', sans-serif;
        }

        .question-item .number {
            color: #00CC66;
            font-weight: 600;
            font-size: 1.2em;
            margin-bottom: 10px;
            font-family: 'Poppins', sans-serif;
        }

        .question-item .question-text {
            font-size: 1.05em;
            margin-bottom: 10px;
            color: #E0E0E0;
            font-weight: 500;
            font-family: 'Poppins', 'Cairo', sans-serif;
            line-height: 1.6;
        }

        .question-item .answer-label {
            color: #B0B0B0;
            font-size: 0.9em;
            margin-top: 10px;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
        }

        .question-type {
            display: inline-block;
            background: rgba(0, 212, 255, 0.2);
            color: #00D4FF;
            padding: 4px 12px;
            border-radius: 8px;
            font-size: 0.8em;
            font-weight: 600;
            margin-bottom: 12px;
            font-family: 'Cascadia Code', monospace;
        }

        .mcq-options {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 12px 0;
            font-family: 'Cascadia Code', monospace;
        }

        .mcq-option {
            padding: 8px 12px;
            margin: 6px 0;
            border-left: 3px solid #00D4FF;
            color: #E0E0E0;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 5px;
        }

        .mcq-option:hover {
            background: rgba(0, 212, 255, 0.1);
            border-left-color: #00CC66;
        }

        .mcq-option.correct {
            color: #00CC66;
            border-left-color: #00CC66;
        }

        .true-false-options {
            display: flex;
            gap: 15px;
            margin: 12px 0;
            font-family: 'Cascadia Code', monospace;
        }

        .tf-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid #00D4FF;
            background: transparent;
            color: #00D4FF;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            font-family: 'Cascadia Code', monospace;
        }

        .tf-btn:hover {
            background: rgba(0, 212, 255, 0.1);
        }

        .tf-btn.correct {
            border-color: #00CC66;
            color: #00CC66;
        }

        .answer-section {
            background: rgba(0, 204, 102, 0.15);
            border-left: 3px solid #00CC66;
            padding: 12px;
            margin-top: 12px;
            border-radius: 8px;
            display: none;
            font-family: 'Cascadia Code', monospace;
        }

        .answer-section.show {
            display: block;
        }

        .answer-section .answer-text {
            color: #00CC66;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .answer-section .answer-explanation {
            color: #B0B0B0;
            font-size: 0.95em;
            line-height: 1.6;
        }

        .show-answer-btn {
            background: transparent;
            border: 1px solid #00CC66;
            color: #00CC66;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85em;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.2s;
            font-family: 'Cascadia Code', monospace;
            font-weight: 600;
        }

        .show-answer-btn:hover {
            background: rgba(0, 204, 102, 0.1);
        }

        .show-answer-btn.active {
            background: rgba(0, 204, 102, 0.2);
        }

        #fileInput { display: none; }

        .status-bar {
            background: linear-gradient(90deg, #00D4FF 0%, #7B2CBF 100%);
            color: white;
            padding: 12px 30px;
            text-align: center;
            font-size: 0.95em;
            font-weight: 600;
        }

        @media (max-width: 968px) {
            .action-buttons { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Left Panel - Controls -->
        <div class="left-panel">
            <div class="header">
                <h1>ğŸ“š Smart Study Assistant</h1>
                <p>Upload, summarize, and test yourself!</p>
            </div>

            <div class="action-buttons">
                <button class="big-button" onclick="document.getElementById('fileInput').click()">
                    <div class="icon">ğŸ“</div>
                    <div class="label">Upload File</div>
                </button>
                <input type="file" id="fileInput" accept=".txt,.pdf,.pptx,.docx" onchange="uploadFile(event)">

                <button class="big-button" onclick="generateSummary()">
                    <div class="icon">ğŸ“</div>
                    <div class="label">Summarize</div>
                </button>

                <button class="big-button" onclick="generateQuestions()">
                    <div class="icon">â“</div>
                    <div class="label">Generate Questions</div>
                </button>

                <button class="big-button" onclick="exportAll()">
                    <div class="icon">ğŸ’¾</div>
                    <div class="label">Export All</div>
                </button>

                <button class="big-button" onclick="showFiles()">
                    <div class="icon">ğŸ“‚</div>
                    <div class="label">My Files</div>
                </button>

                <button class="big-button btn-clear" onclick="clearAll()">
                    <div class="icon">ğŸ—‘ï¸</div>
                    <div class="label">Clear All</div>
                </button>
            </div>

            <div class="status-bar" id="statusBar">Ready to use ğŸš€</div>
        </div>

        <!-- Right Panel - Results -->
        <div class="right-panel">
            <div class="right-header">
                <h2 id="rightTitle">ğŸ“– Results</h2>
            </div>

            <div class="content-area">
                <div class="output-box" id="outputBox">
                    <div style="text-align: center; color: #999; padding: 80px 40px;">
                        <div style="font-size: 4em; margin-bottom: 20px;">ğŸ“š</div>
                        <h2 style="color: #00D4FF; font-weight: 800; font-size: 2em; margin-bottom: 15px;">Welcome!</h2>
                        <p style="font-size: 1.2em; color: #00CC66;">Upload a file to get started</p>
                        <p style="font-size: 1em; color: #999; margin-top: 20px;">Supported formats: PDF, PowerPoint, TXT, DOCX</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Files Section (Hidden by default) -->
        <div class="files-section" id="filesSection" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 1000; backdrop-filter: blur(5px);">
            <div style="background: rgba(255, 255, 255, 0.95); margin: 50px auto; max-width: 900px; border-radius: 20px; padding: 30px; max-height: 80vh; overflow-y: auto; backdrop-filter: blur(10px);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="color: #00D4FF; font-size: 1.8em; font-weight: 800; margin: 0;">ğŸ“‚ Stored Files</h2>
                    <button onclick="document.getElementById('filesSection').style.display='none'" style="background: rgba(26, 26, 46, 0.8); border: 1px solid rgba(0, 212, 255, 0.3); padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: 600; color: #00D4FF;">âœ– Close</button>
                </div>
                <div class="files-grid" id="filesGrid"></div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <script>
        let currentFileContent = '';
        let currentFileName = '';
        let storedFiles = JSON.parse(localStorage.getItem('studyFiles')) || [];

        // Ø¥Ø¹Ø¯Ø§Ø¯ PDF.js Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
        if (typeof pdfjsLib !== 'undefined') {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
            
            // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª Ø§Ù„Ù…Ø²Ø¹Ø¬Ø©
            pdfjsLib.verbosity = pdfjsLib.VerbosityLevel.ERRORS;
        }

        async function uploadFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            currentFileName = file.name;
            const fileExt = file.name.split('.').pop().toLowerCase();

            updateStatus('â³ Ø¬Ø§Ø±ÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù...');

            try {
                if (fileExt === 'pdf') {
                    await loadPDF(file);
                } else if (fileExt === 'pptx') {
                    await loadPowerPoint(file);
                } else if (fileExt === 'txt' || fileExt === 'docx') {
                    await loadTextFile(file);
                } else {
                    alert('âš ï¸ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…! Ø§Ù„Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø©: .txt, .pdf, .pptx, .docx');
                }
            } catch (error) {
                console.error('Error loading file:', error);
                alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù!');
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Ù‚Ø±Ø§Ø¡Ø© PDF
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function loadPDF(file) {
            try {
                const arrayBuffer = await file.arrayBuffer();
                
                // Ø®ÙŠØ§Ø±Ø§Øª ØªØ­Ù…ÙŠÙ„ PDF Ù…Ø­Ø³Ù‘Ù†Ø©
                const loadingTask = pdfjsLib.getDocument({
                    data: arrayBuffer,
                    disableFontFace: false,  // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø®Ø·ÙˆØ·
                    standardFontDataUrl: 'https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/standard_fonts/',
                    // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„ØµØºÙŠØ±Ø©
                    stopAtErrors: false
                });
                
                const pdf = await loadingTask.promise;
                
                let fullText = '';
                const numPages = pdf.numPages;
                
                updateStatus(`ğŸ“„ Ù‚Ø±Ø§Ø¡Ø© PDF - ${numPages} ØµÙØ­Ø©...`);

                for (let i = 1; i <= numPages; i++) {
                    try {
                        const page = await pdf.getPage(i);
                        const textContent = await page.getTextContent();
                        
                        fullText += `\n${'='.repeat(50)}\n`;
                        fullText += `ğŸ“„ ØµÙØ­Ø© ${i}\n`;
                        fullText += `${'='.repeat(50)}\n`;
                        
                        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ Ù…Ù† Ø§Ù„ØµÙØ­Ø©
                        let pageText = '';
                        textContent.items.forEach(item => {
                            if (item.str && item.str.trim()) {
                                pageText += item.str + ' ';
                            }
                        });
                        
                        fullText += pageText.trim() + '\n';
                        
                        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø¯Ù…
                        updateStatus(`ğŸ“„ Ù‚Ø±Ø§Ø¡Ø© ØµÙØ­Ø© ${i}/${numPages}...`);
                        
                    } catch (pageError) {
                        console.warn(`âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© ØµÙØ­Ø© ${i}:`, pageError);
                        fullText += `\n[âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù‚Ø±Ø§Ø¡Ø© ØµÙØ­Ø© ${i}]\n`;
                    }
                }

                currentFileContent = fullText;
                saveAndDisplayFile(file.name, fullText);
                updateStatus(`âœ… ØªÙ… Ù‚Ø±Ø§Ø¡Ø© PDF (${numPages} ØµÙØ­Ø©)`);
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© PDF:', error);
                
                // Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ ÙˆØ§Ø¶Ø­Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
                if (error.message.includes('Invalid PDF')) {
                    alert('âš ï¸ Ù…Ù„Ù PDF ØªØ§Ù„Ù Ø£Ùˆ ØºÙŠØ± ØµØ§Ù„Ø­!');
                } else if (error.message.includes('password')) {
                    alert('ğŸ”’ Ù…Ù„Ù PDF Ù…Ø­Ù…ÙŠ Ø¨ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±!');
                } else {
                    alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© PDF. Ø¬Ø±Ø¨ Ù…Ù„Ù Ø¢Ø®Ø± Ø£Ùˆ Ø§Ø­ÙØ¸Ù‡ Ø¨ØµÙŠØºØ© Ø¬Ø¯ÙŠØ¯Ø©.');
                }
                
                throw error;
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Ù‚Ø±Ø§Ø¡Ø© PowerPoint
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function loadPowerPoint(file) {
            const arrayBuffer = await file.arrayBuffer();
            const zip = await JSZip.loadAsync(arrayBuffer);
            
            let fullText = '';
            let slideNumber = 0;
            const slidePromises = [];

            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø´Ø±Ø§Ø¦Ø­
            zip.folder("ppt/slides").forEach((relativePath, file) => {
                if (relativePath.endsWith('.xml')) {
                    slidePromises.push(
                        file.async("string").then(content => {
                            slideNumber++;
                            return { 
                                number: slideNumber, 
                                content: extractTextFromSlide(content) 
                            };
                        })
                    );
                }
            });

            const slides = await Promise.all(slidePromises);
            slides.sort((a, b) => a.number - b.number);

            updateStatus(`ğŸ“Š Ù‚Ø±Ø§Ø¡Ø© PowerPoint - ${slides.length} Ø´Ø±ÙŠØ­Ø©...`);

            slides.forEach(slide => {
                fullText += `\n${'='.repeat(50)}\n`;
                fullText += `ğŸ“Š Ø´Ø±ÙŠØ­Ø© ${slide.number}\n`;
                fullText += `${'='.repeat(50)}\n`;
                fullText += slide.content + '\n';
            });

            currentFileContent = fullText;
            saveAndDisplayFile(file.name, fullText);
            updateStatus(`âœ… ØªÙ… Ù‚Ø±Ø§Ø¡Ø© PowerPoint (${slides.length} Ø´Ø±ÙŠØ­Ø©)`);
        }

        function extractTextFromSlide(xmlContent) {
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(xmlContent, "text/xml");
            const textElements = xmlDoc.getElementsByTagName('a:t');
            let text = '';
            
            for (let i = 0; i < textElements.length; i++) {
                text += textElements[i].textContent + '\n';
            }
            
            return text.trim();
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„ÙØ§Øª Ù†ØµÙŠØ©
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function loadTextFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();

                reader.onload = function(e) {
                    let content = e.target.result;
                    
                    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥ØµÙ„Ø§Ø­ encoding
                    try {
                        if (content.includes('ï¿½') || /[\x00-\x08\x0E-\x1F]/.test(content)) {
                            console.log("âš ï¸ Detected encoding issue, trying alternative...");
                            
                            const reader2 = new FileReader();
                            reader2.onload = function(e2) {
                                const bytes = new Uint8Array(e2.target.result);
                                
                                // Ø¬Ø±Ø¨ encodings Ù…Ø®ØªÙ„ÙØ©
                                const encodings = ['windows-1256', 'windows-1252', 'iso-8859-1', 'utf-8'];
                                let decoded = null;
                                
                                for (let encoding of encodings) {
                                    try {
                                        const decoder = new TextDecoder(encoding);
                                        const test = decoder.decode(bytes);
                                        
                                        if (/[a-zA-Z\u0600-\u06FF]/.test(test) && !test.includes('ï¿½')) {
                                            decoded = test;
                                            console.log(`âœ… Successfully decoded with ${encoding}`);
                                            break;
                                        }
                                    } catch(e) {
                                        continue;
                                    }
                                }
                                
                                if (decoded) {
                                    currentFileContent = decoded;
                                    saveAndDisplayFile(file.name, decoded);
                                    resolve();
                                } else {
                                    reject(new Error('Cannot decode file'));
                                }
                            };
                            reader2.readAsArrayBuffer(file);
                            return;
                        }
                        
                        currentFileContent = content;
                        saveAndDisplayFile(file.name, content);
                        resolve();
                        
                    } catch(err) {
                        reject(err);
                    }
                };

                reader.onerror = () => reject(new Error('File read error'));
                reader.readAsText(file, 'UTF-8');
            });
        }

        function saveAndDisplayFile(fileName, content) {
            const fileData = {
                name: fileName,
                content: content,
                date: new Date().toLocaleDateString('ar-SA'),
                size: (content.length / 1024).toFixed(2)
            };
            
            storedFiles.push(fileData);
            localStorage.setItem('studyFiles', JSON.stringify(storedFiles));

            updateStatus(`âœ… ØªÙ… Ø±ÙØ¹: ${fileName}`);
            
            document.getElementById('outputBox').innerHTML = `
                <div class="summary-card">
                    <h3>ğŸ“„ ${fileName}</h3>
                    <p style="white-space: pre-wrap;">${content.substring(0, 500)}...</p>
                    <p style="margin-top: 15px; color: #999;">
                        Ø§Ù„Ø­Ø¬Ù…: ${fileData.size} ÙƒÙŠÙ„ÙˆØ¨Ø§ÙŠØª
                    </p>
                </div>
            `;
        }

        function showFiles() {
            const filesSection = document.getElementById('filesSection');
            const filesGrid = document.getElementById('filesGrid');
            
            if (storedFiles.length === 0) {
                alert('No stored files yet!');
                return;
            }

            filesSection.style.display = 'block';
            filesGrid.innerHTML = '';

            storedFiles.forEach((file, index) => {
                const fileCard = document.createElement('div');
                fileCard.className = 'file-card';
                fileCard.onclick = () => {
                    loadFile(index);
                    filesSection.style.display = 'none';
                };
                
                const icon = file.name.endsWith('.pdf') ? 'ğŸ“•' : file.name.endsWith('.pptx') ? 'ğŸ“Š' : 'ğŸ“„';
                
                fileCard.innerHTML = `
                    <div class="file-icon">${icon}</div>
                    <div class="file-name">${file.name}</div>
                    <div class="file-date">${file.date}</div>
                `;
                
                filesGrid.appendChild(fileCard);
            });

            updateStatus(`ğŸ“‚ Showing ${storedFiles.length} file(s)`);
        }

        function loadFile(index) {
            const file = storedFiles[index];
            currentFileName = file.name;
            currentFileContent = file.content;

            document.getElementById('outputBox').innerHTML = `
                <div class="summary-card">
                    <h3>ğŸ“„ ${file.name}</h3>
                    <p>${file.content.substring(0, 500)}...</p>
                </div>
            `;

            updateStatus(`âœ… ØªÙ… ÙØªØ­: ${file.name}`);
        }

        function generateSummary() {
            if (!currentFileContent) {
                alert('Please upload a file first!');
                return;
            }

            document.getElementById('rightTitle').textContent = 'ğŸ“ Summary';

            const lines = currentFileContent.split('\n').filter(l => l.trim());
            const important = [];

            lines.forEach(line => {
                if (line.includes(':') || /^\d+\./.test(line) || line.length > 50) {
                    important.push(line);
                }
            });

            let html = '<h2 style="color: #2B3674; margin-bottom: 25px; font-weight: 800; font-size: 1.8em;">ğŸ“‹ Summary</h2>';
            
            important.slice(0, 15).forEach((line, i) => {
                html += `
                    <div class="summary-card">
                        <h3>Point ${i + 1}</h3>
                        <p>${line}</p>
                    </div>
                `;
            });

            document.getElementById('outputBox').innerHTML = html;
            updateStatus('âœ… Summary generated');
        }

        function generateQuestions() {
            if (!currentFileContent) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø±ÙØ¹ Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹!');
                return;
            }

            const lines = currentFileContent.split('\n').filter(l => l.trim() && l.length > 20);
            
            // ÙƒØ´Ù Ø§Ù„Ù„ØºØ© (Ø¹Ø±Ø¨ÙŠ Ø£Ùˆ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)
            const hasArabic = /[\u0600-\u06FF]/.test(currentFileContent);
            const isEnglish = !hasArabic || (currentFileContent.match(/[a-zA-Z]/g) || []).length > (currentFileContent.match(/[\u0600-\u06FF]/g) || []).length;
            
            let html = `<h2 style="color: #2B3674; margin-bottom: 20px; font-weight: 800; font-family: 'Cascadia Code', monospace;">â“ ${isEnglish ? 'Generated Questions' : 'Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…ÙˆÙ„Ø¯Ø©'}</h2>`;
            
            let qNum = 1;
            const questions = [];

            // Ø£Ø³Ø¦Ù„Ø© Ù…Ù‚Ø§Ù„ÙŠØ© Ù…Ù† Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†
            lines.slice(0, 5).forEach(line => {
                if (line.includes(':') || /^\d+\./.test(line) || /^Chapter|^Section|^Ø§Ù„ÙØµÙ„|^Ø§Ù„Ù‚Ø³Ù…/.test(line)) {
                    const topic = line.split(':')[0].replace(/^\d+\./, '').replace(/^Chapter|^Section/, '').trim();
                    
                    if (topic.length > 5 && topic.length < 100) {
                        questions.push({
                            type: 'essay',
                            question: isEnglish ? `Explain the concept of "${topic}".` : `Ø§Ø´Ø±Ø­ Ù…ÙÙ‡ÙˆÙ… "${topic}".`,
                            answer: isEnglish ? 'Write a comprehensive explanation based on the content.' : 'Ø§ÙƒØªØ¨ Ø´Ø±Ø­Ø§Ù‹ Ø´Ø§Ù…Ù„Ø§Ù‹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­ØªÙˆÙ‰.'
                        });
                    }
                }
            });

            // Ø£Ø³Ø¦Ù„Ø© Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯
            const mcqQuestions = isEnglish ? [
                {
                    type: 'mcq',
                    question: 'Which of the following best describes the main topic?',
                    options: ['Option A: Related to primary concept', 'Option B: Focuses on key principles', 'Option C: Covers essential details', 'Option D: All of the above'],
                    correctAnswer: 'Option D: All of the above',
                    explanation: 'Based on comprehensive analysis of the content.'
                },
                {
                    type: 'mcq',
                    question: 'What is a key characteristic mentioned?',
                    options: ['It is foundational', 'It applies widely', 'It requires practice', 'Both A and B'],
                    correctAnswer: 'Both A and B',
                    explanation: 'Multiple characteristics are emphasized throughout.'
                }
            ] : [
                {
                    type: 'mcq',
                    question: 'Ø£ÙŠ Ù…Ù† Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© ÙŠØµÙ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø¨Ø´ÙƒÙ„ Ø£ÙØ¶Ù„ØŸ',
                    options: ['Ø§Ù„Ø®ÙŠØ§Ø± Ø£: ÙŠØªØ¹Ù„Ù‚ Ø¨Ø§Ù„Ù…ÙÙ‡ÙˆÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ', 'Ø§Ù„Ø®ÙŠØ§Ø± Ø¨: ÙŠØ±ÙƒØ² Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¨Ø§Ø¯Ø¦ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', 'Ø§Ù„Ø®ÙŠØ§Ø± Ø¬: ÙŠØºØ·ÙŠ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©', 'Ø§Ù„Ø®ÙŠØ§Ø± Ø¯: Ø¬Ù…ÙŠØ¹ Ù…Ø§ Ø³Ø¨Ù‚'],
                    correctAnswer: 'Ø§Ù„Ø®ÙŠØ§Ø± Ø¯: Ø¬Ù…ÙŠØ¹ Ù…Ø§ Ø³Ø¨Ù‚',
                    explanation: 'Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø§Ù…Ù„ Ù„Ù„Ù…Ø­ØªÙˆÙ‰.'
                },
                {
                    type: 'mcq',
                    question: 'Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø®Ø§ØµÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø§Ù„Ù…Ø°ÙƒÙˆØ±Ø©ØŸ',
                    options: ['Ø¥Ù†Ù‡Ø§ Ø£Ø³Ø§Ø³ÙŠØ©', 'ØªØ·Ø¨Ù‚ Ø¹Ù„Ù‰ Ù†Ø·Ø§Ù‚ ÙˆØ§Ø³Ø¹', 'ØªØªØ·Ù„Ø¨ Ù…Ù…Ø§Ø±Ø³Ø©', 'Ø£ Ùˆ Ø¨ Ù…Ø¹Ø§Ù‹'],
                    correctAnswer: 'Ø£ Ùˆ Ø¨ Ù…Ø¹Ø§Ù‹',
                    explanation: 'ÙŠØªÙ… Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø®ØµØ§Ø¦Øµ Ù…ØªØ¹Ø¯Ø¯Ø© ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø£Ù†Ø­Ø§Ø¡ Ø§Ù„Ù…Ø­ØªÙˆÙ‰.'
                }
            ];

            // Ø£Ø³Ø¦Ù„Ø© ØµØ­ Ø£Ùˆ Ø®Ø·Ø£
            const tfQuestions = isEnglish ? [
                {
                    type: 'tf',
                    question: 'True or False: The main concept is important to understand.',
                    correctAnswer: 'True',
                    explanation: 'The content emphasizes the importance of understanding this topic.'
                },
                {
                    type: 'tf',
                    question: 'True or False: This topic has only theoretical applications.',
                    correctAnswer: 'False',
                    explanation: 'The content clearly shows both theoretical and practical applications.'
                }
            ] : [
                {
                    type: 'tf',
                    question: 'ØµØ­ Ø£Ù… Ø®Ø·Ø£: Ø§Ù„Ù…ÙÙ‡ÙˆÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù…Ù‡Ù… Ù„ÙÙ‡Ù… Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹.',
                    correctAnswer: 'ØµØ­',
                    explanation: 'Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙŠØ¤ÙƒØ¯ Ø¹Ù„Ù‰ Ø£Ù‡Ù…ÙŠØ© ÙÙ‡Ù… Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹.'
                },
                {
                    type: 'tf',
                    question: 'ØµØ­ Ø£Ù… Ø®Ø·Ø£: Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ Ù„Ù‡ ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ù†Ø¸Ø±ÙŠØ© ÙÙ‚Ø·.',
                    correctAnswer: 'Ø®Ø·Ø£',
                    explanation: 'Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙŠÙˆØ¶Ø­ Ø¨ÙˆØ¶ÙˆØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ù†Ø¸Ø±ÙŠØ© ÙˆØ§Ù„Ø¹Ù…Ù„ÙŠØ© Ù…Ø¹Ø§Ù‹.'
                }
            ];

            // Ø¯Ù…Ø¬ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
            const allQuestions = [...questions, ...mcqQuestions, ...tfQuestions];

            allQuestions.forEach(q => {
                const qId = `q_${qNum}`;
                let qHtml = `
                    <div class="question-item">
                        <div class="number">${isEnglish ? 'Question' : 'Ø³Ø¤Ø§Ù„'} ${qNum}</div>
                        <span class="question-type">${q.type === 'mcq' ? 'Multiple Choice' : q.type === 'tf' ? 'True/False' : 'Essay'}</span>
                        <div class="question-text">${q.question}</div>
                `;

                if (q.type === 'mcq') {
                    qHtml += `
                        <div class="mcq-options">
                            ${q.options.map(opt => `
                                <div class="mcq-option" onclick="selectOption(this, '${qId}', '${opt === q.correctAnswer}')">
                                    ${opt}
                                </div>
                            `).join('')}
                        </div>
                    `;
                } else if (q.type === 'tf') {
                    const trueLabel = isEnglish ? 'True' : 'ØµØ­';
                    const falseLabel = isEnglish ? 'False' : 'Ø®Ø·Ø£';
                    qHtml += `
                        <div class="true-false-options">
                            <button class="tf-btn" onclick="selectTF(this, '${qId}', '${trueLabel === q.correctAnswer}')"><strong>${trueLabel}</strong></button>
                            <button class="tf-btn" onclick="selectTF(this, '${qId}', '${falseLabel === q.correctAnswer}')"><strong>${falseLabel}</strong></button>
                        </div>
                    `;
                } else {
                    qHtml += `<div class="answer-label">${isEnglish ? 'Answer:' : 'Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©:'} _______________________________</div>`;
                }

                qHtml += `
                    <button class="show-answer-btn" onclick="toggleAnswer('${qId}')">${isEnglish ? 'Show Answer' : 'Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©'}</button>
                    <div class="answer-section" id="answer_${qId}">
                        <div class="answer-text">${isEnglish ? 'âœ“ Answer:' : 'âœ“ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©:'} ${q.correctAnswer}</div>
                        <div class="answer-explanation">${q.explanation}</div>
                    </div>
                    </div>
                `;
                html += qHtml;
                qNum++;
            });

            document.getElementById('outputBox').innerHTML = html;
            updateStatus(`âœ… ${isEnglish ? 'Generated' : 'ØªÙ… ØªÙˆÙ„ÙŠØ¯'} ${allQuestions.length} ${isEnglish ? 'questions' : 'Ø£Ø³Ø¦Ù„Ø©'}`);
        }

        function selectOption(element, questionId, isCorrect) {
            const container = element.parentElement;
            container.querySelectorAll('.mcq-option').forEach(opt => opt.classList.remove('correct'));
            if (isCorrect === 'true') {
                element.classList.add('correct');
            }
        }

        function selectTF(element, questionId, isCorrect) {
            const container = element.parentElement;
            container.querySelectorAll('.tf-btn').forEach(btn => btn.classList.remove('correct'));
            if (isCorrect === 'true') {
                element.classList.add('correct');
            }
        }

        function toggleAnswer(questionId) {
            const answerSection = document.getElementById(`answer_${questionId}`);
            const button = event.target;
            answerSection.classList.toggle('show');
            button.classList.toggle('active');
        }
        

        function exportAll() {
            if (!currentFileContent) {
                alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰ Ù„Ù„ØªØµØ¯ÙŠØ±!');
                return;
            }

            const content = `
${'='.repeat(70)}
ğŸ“š ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø°ÙƒÙŠ
${'='.repeat(70)}
ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date().toLocaleString('ar-SA')}
ğŸ“„ Ø§Ù„Ù…Ù„Ù: ${currentFileName}
${'='.repeat(70)}

ğŸ“– Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø£ØµÙ„ÙŠ:
${currentFileContent}

${'='.repeat(70)}
âœ… ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­
${'='.repeat(70)}
            `.trim();

            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `export_${Date.now()}.txt`;
            a.click();
            URL.revokeObjectURL(url);

            updateStatus('âœ… ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­!');
        }

        function clearAll() {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ØŸ')) {
                currentFileContent = '';
                currentFileName = '';
                document.getElementById('outputBox').innerHTML = `
                    <div style="text-align: center; color: #999; padding: 40px;">
                        <h2 style="color: #00D4FF;">ØªÙ… Ø§Ù„Ù…Ø³Ø­ âœ“</h2>
                        <p style="margin-top: 20px;">Ø§Ø¨Ø¯Ø£ Ù…Ù† Ø¬Ø¯ÙŠØ¯!</p>
                    </div>
                `;
                updateStatus('ğŸ—‘ï¸ ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ù…Ø­ØªÙˆÙ‰');
            }
        }

        function updateStatus(message) {
            const statusBar = document.getElementById('statusBar');
            statusBar.textContent = message;
            setTimeout(() => {
                statusBar.textContent = 'Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ğŸš€';
            }, 3000);
        }

        window.addEventListener('DOMContentLoaded', () => {
            // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
            if (storedFiles.length > 0) {
                logger.info("ğŸ“‚ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© - Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø¹Ø±Ø¶");
                setTimeout(() => {
                    showFiles();
                }, 300);
            } else {
                logger.info("ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª Ù…Ø­ÙÙˆØ¸Ø© Ø­Ø§Ù„ÙŠØ§Ù‹");
            }
        });
    </script>
</body>
</html>   